"use strict";angular.module("jensenArticleQuantity",["twsArticleService","twsApi"]),angular.module("jensenArticleQuantity").directive("jensenArticleQuantity",["twsApi.Jed","twsArticleService.ArticleService","$q","twsApi.Locale","twsApi.Select","$injector",function(e,t,i,n,a,l){return{restrict:"E",scope:{articleUid:"=articleUid"},templateUrl:"jensen-article-quantity/templates/jensenArticleQuantity.html",link:function(i,s,r){e(i,"tws-article-quantity"),i.lang=n.language();var o=a("globalSettings.twsBuyButton.watchItemEnabled",l.get("themeSettings"));i.watchItemEnabled=!1,"boolean"==typeof o&&(i.watchItemEnabled=o),i.$watch("articleUid",function(e){e&&t.update(i.articleUid).then(function(e){if(i.article=e.article,void 0!==i.article.choiceSchema[i.lang].properties){i.choices=i.article.choiceSchema[i.lang].properties,i.originalSettings=i.choices.quantity,i.model=e.schemaForm.model;var t=i.originalSettings;i.settings={"default":angular.isDefined(t["default"])?t["default"]:1,divisibleBy:angular.isDefined(t.divisibleBy)?t.divisibleBy:1,minimum:angular.isDefined(t["default"])?t["default"]:angular.isDefined(t.divisibleBy)?t.divisibleBy:1,maximum:t.maximum},i.divisibleBy=Big(i.settings.divisibleBy),i.quantityOptions=[];var n=e.article.stock.message[i.lang]||"",a=parseInt(n.replace(/[^\d]*/,""),10);if(!isNaN(a))for(var l=1;l<=a;l++)i.quantityOptions.push({name:50*l+" cm  (Val "+l+") ",value:l})}})}),i.inc=function(){if(void 0===i.model.quantity)return void(i.model.quantity=i.settings.minimum);var e=Big(i.model.quantity);e=e.plus(i.divisibleBy),i.settings.maximum&&1===e.cmp(i.settings.maximum)?i.model.quantity=i.settings.maximum:i.model.quantity=parseFloat(e.toString())},i.dec=function(){if(void 0===i.model.quantity)return void(i.model.quantity=i.settings.minimum);var e=Big(i.model.quantity);e=e.minus(i.divisibleBy),i.settings.minimum&&e.cmp(i.settings.minimum)===-1?i.model.quantity=i.settings.minimum:i.model.quantity=parseFloat(e.toString())}}}}]),angular.module("jensenArticleQuantity").run(["$templateCache",function(e){e.put("jensen-article-quantity/templates/jensenArticleQuantity.html",'<div ng-show="article.uid && originalSettings && !article.presentationOnly && (!watchItemEnabled || (watchItemEnabled && article.isBuyable))"><div class="row tws-article-quantity--input-row"><div class="form-group col-md-5 tws-article-quantity--input-wrapper" ng-class="{\'has-error\': ngModel.$dirty && ngModel.$invalid, \'has-success\': ngModel.$dirty && ngModel.$valid }"><label class="control-label">{{::gettext(\'Quantity\')}}</label><div class="input-group" ng-if="article.unit.sv === \'50 cm\'"><select type="number" name="quantity" class="form-control" required="" ng-options="o.value as o.name for o in quantityOptions" ng-model="model.quantity"></select></div></div></div><div class="row tws-article-quantity--help-block"><div class="col-sm-12 help-block"><span ng-show="ngModel.$error.step">{{ ::gettext(\'This value doesn\\\'t have the right number of decimals.\') }}</span> <span ng-show="ngModel.$error.min">{{ ::gettext(\'This value is too small.\') }}</span> <span ng-show="ngModel.$error.max">{{ ::gettext(\'This value is too large.\') }}</span> <span ng-show="ngModel.$error.required">{{ ::gettext(\'This is required.\') }}</span> <span ng-show="ngModel.$error.number">{{ ::gettext(\'Invalid value.\') }}</span></div></div></div>')}]);